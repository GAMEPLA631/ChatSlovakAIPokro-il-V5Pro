<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatSlovak AI | Pro Model</title>
    <!-- Naƒç√≠tanie Tailwind CSS pre jednoduch√Ω a modern√Ω styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Nastavenie p√≠sma Inter a z√°kladn√©ho sklenen√©ho pozadia */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a6c0fe 0%, #f68084 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        /* Glassmorphism efekt pre kontajner */
        .glass-container {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        /* ≈†t√Ωl spr√°vy od AI pre lep≈°√≠ kontrast na skle */
        .ai-message {
            background: rgba(255, 255, 255, 0.8);
            color: #1f2937;
            border-radius: 0.75rem;
            padding: 0.75rem;
        }

        /* ≈†t√Ωl spr√°vy od pou≈æ√≠vateƒæa */
        .user-message {
            background: rgba(144, 202, 249, 0.7);
            color: #1f2937;
            border-radius: 0.75rem;
            padding: 0.75rem;
        }

        /* ≈†t√Ωl tlaƒçidla a vstupu */
        .glass-input, .glass-button {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            transition: all 0.2s;
        }

        .glass-button:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .glass-input:disabled {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }

        .glass-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .toggle-switch {
            width: 44px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            position: relative;
            cursor: pointer;
            transition: background 0.4s;
        }
        .toggle-switch:after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: 0.4s;
        }
        .toggle-switch.active {
            background: #34D399; /* Emerald 400 */
        }
        .toggle-switch.active:after {
            left: calc(100% - 22px);
        }
    </style>
    <script>
        // Kon≈°tanta pre API Key. Vlo≈æ svoj kƒæ√∫ƒç tu.
        const apiKey = "AIzaSyDdiCiIfr2gLtsRMENBkWG1hJo6N1uij7w"; // !!! KƒΩ√öƒå JE NASTAVEN√ù NA PR√ÅZDNY RE≈§AZEC PRE AUTOMATICK√ö AUTENTIFIK√ÅCIU V CANVASE !!!
        
        // --- ≈†PECIFIKOVAN√ù MODEL ---
        const MODEL_NAME = "gemini-2.5-flash-preview-05-20";
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`;

        // --- KON≈†TANTY PRE LIMITY ---
        const MAX_MESSAGES = 30;
        const MAX_LUA_REQUESTS = 16;
        const RESET_DURATION = 3600000; // 1 hodina v milisekund√°ch
        const LS_KEY = 'aiChatLimitsV5Pro';
        const LUA_KEYWORDS = ['lua', 'roblox', 'npc', 'mapa', 'k√≥d', 'vygeneruj'];
        // -----------------------------

        // --- TTS Konfigur√°cia ---
        let ttsEnabled = false;
        const ttsStorageKey = 'ttsEnabledProChat';
        let slovakVoice = null;
        const synth = window.speechSynthesis;

        // Robustn√© syst√©mov√© in≈°trukcie pre pokroƒçil√© schopnosti AI
        const SYSTEM_PROMPT_SK = `
            You are an advanced, highly capable, and creative AI assistant with real-time access to information via Google Search. Your primary task is to provide detailed, creative, and technically accurate responses, always in **Slovak (Slovenƒçina)**. You are capable of:
            1. Analyzing and synthesizing information obtained from the web (Google/YouTube).
            2. Generating **complete and functional Roblox Lua code** designed for **direct execution in the Roblox Studio Command Bar** (or a standard script). This includes:
               a. Creation of 3D models and assets (Parts, Unions, MeshParts).
               b. Advanced game logic for NPCs, maps, and special effects.
               ***CRITICAL RULE: When a user explicitly requests code (e.g., uses keywords like 'k√≥d', 'vygeneruj', 'lua'), minimize conversational preamble and focus purely on the technical output. Provide the complete, runnable Lua code in a single code block immediately, followed only by a very brief explanation if necessary.***
            3. **Generovanie Hudobn√Ωch ≈Ω√°nrov a ≈†t√Ωlov (AI Music Prompting):** Dok√°≈æe≈° generova≈• rozsiahle a detailn√© promptov√© re≈•azce pre AI gener√°tory hudby (ako je Suno AI). Konkr√©tne, dok√°≈æe≈° vytv√°ra≈• **dva ≈°pecializovan√© a extr√©mne zoznamy kƒæ√∫ƒçov√Ωch slov** (napr. 'Zoznam 1: Extr√©mny a Agres√≠vny Bass' a 'Zoznam 2: Temn√Ω a Atmosf√©rick√Ω Horror'). Tieto ≈æ√°nre musia by≈• expres√≠vne a kombinova≈• prvky n√°lady, ≈æ√°nru, tempa, in≈°trument√°cie a extr√©mneho produkƒçn√©ho ≈°t√Ωlu (napr√≠klad: 'Extreme Bass, Brutal Aggression, Distorted 808s, Sub-Bass, Hyper-Aggressive, Dark Trap, Industrial Noise, Speedcore').
            4. Poskytovanie be≈æn√Ωch, bystr√Ωch a kreat√≠vnych odpoved√≠ na chat.
            Your responses should reflect the capabilities of a 'Pro' model (${MODEL_NAME}).
        `;

        let chatHistory = [];
        let isGenerating = false;
        let currentLimits = {
            messageCount: 0,
            luaRequestCount: 0,
            resetTimestamp: 0 // Timestamp, kedy d√¥jde k resetu
        };

        /**
         * Naƒç√≠ta hlasy a pok√∫si sa n√°js≈• slovensk√Ω hlas.
         */
        function loadVoices() {
            const voices = synth.getVoices();
            slovakVoice = voices.find(voice => voice.lang === 'sk-SK') || 
                          voices.find(voice => voice.lang.startsWith('sk')) || 
                          voices.find(voice => voice.lang === 'cs-CZ') || // Alternat√≠va ak nie je SK hlas
                          voices.find(voice => voice.default); // Pou≈æije sa defaultn√Ω hlas ak SK/CS nie je dostupn√©
            
            // Ak sa hlasy nenaƒç√≠tali hneƒè, prid√°me listener
            if (voices.length === 0) {
                synth.onvoiceschanged = () => {
                    loadVoices(); // Rekurz√≠vne zavolanie po naƒç√≠tan√≠
                    synth.onvoiceschanged = null; // Odstr√°nenie listenera
                };
            }
        }

        /**
         * Prep√≠na stav TTS a uklad√° ho do localStorage.
         */
        function toggleTts() {
            ttsEnabled = !ttsEnabled;
            localStorage.setItem(ttsStorageKey, ttsEnabled.toString());
            updateTtsToggleUI();
            
            if (synth.speaking) {
                synth.cancel(); // Zastav√≠ hovorenie, ak bolo zapnut√©
            }
        }

        /**
         * Aktualizuje vzhƒæad prep√≠naƒça TTS.
         */
        function updateTtsToggleUI() {
            const toggle = document.getElementById('tts-toggle');
            if (toggle) {
                if (ttsEnabled) {
                    toggle.classList.add('active');
                } else {
                    toggle.classList.remove('active');
                }
            }
        }

        /**
         * Inicializuje aplik√°ciu po naƒç√≠tan√≠ okna.
         */
        window.onload = () => {
            // Inicializ√°cia TTS
            loadVoices();
            ttsEnabled = localStorage.getItem(ttsStorageKey) === 'true';
            
            document.getElementById('send-button').addEventListener('click', sendMessage);
            document.getElementById('user-input').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            document.getElementById('tts-toggle').addEventListener('click', toggleTts);

            initializeLimits();
            checkAndUpdateUI();
            updateTtsToggleUI(); // Nastav√≠ poƒçiatoƒçn√Ω stav tlaƒçidla TTS
            
            // Nastav√≠me interval, ktor√Ω kontroluje a aktualizuje UI ka≈æd√∫ sekundu
            setInterval(checkAndUpdateUI, 1000); 
            displayWelcomeMessage();
        };
        
        // Funkcia Text-to-Speech
        function speakMessage(text) {
            // Ak je TTS vypnut√© alebo prehliadaƒç nepodporuje
            if (!ttsEnabled || !synth || !slovakVoice) return;
            
            // Zru≈°√≠me ak√©koƒævek prebiehaj√∫ce hovorenie
            synth.cancel();

            // Odstr√°nime Markdown k√≥d bloky (Lua k√≥dy) pred hovoren√≠m, aby AI neƒç√≠tala k√≥d
            const textToSpeak = text.replace(/```[\s\S]*?```/g, 'Generovan√Ω k√≥d bol vynechan√Ω.').replace(/\*\*/g, '');
            
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.voice = slovakVoice;
            utterance.lang = slovakVoice.lang;
            utterance.rate = 1.0; // R√Ωchlos≈•
            
            synth.speak(utterance);
        }

        /**
         * Naƒç√≠ta alebo inicializuje limity z localStorage a automaticky resetuje, ak vypr≈°al ƒças.
         */
        function initializeLimits() {
            const storedLimits = localStorage.getItem(LS_KEY);
            const now = Date.now();

            if (storedLimits) {
                currentLimits = JSON.parse(storedLimits);
                
                // Ak vypr≈°al resetTimestamp, resetujeme
                if (currentLimits.resetTimestamp <= now) {
                    resetLimits();
                }
            } else {
                // Prv√© spustenie, inicializujeme
                resetLimits();
            }
        }

        /**
         * Resetuje limity a nastav√≠ nov√Ω resetTimestamp.
         */
        function resetLimits() {
            currentLimits.messageCount = 0;
            currentLimits.luaRequestCount = 0;
            currentLimits.resetTimestamp = Date.now() + RESET_DURATION;
            saveLimits();
        }

        /**
         * Ulo≈æ√≠ aktu√°lne limity do localStorage.
         */
        function saveLimits() {
            localStorage.setItem(LS_KEY, JSON.stringify(currentLimits));
        }

        /**
         * Kontroluje limity a aktualizuje UI (tlaƒçidlo, ƒçasovaƒç).
         */
        function checkAndUpdateUI() {
            const now = Date.now();
            const timeRemaining = currentLimits.resetTimestamp - now;
            const inputElement = document.getElementById('user-input');
            const buttonElement = document.getElementById('send-button');
            const limitDisplay = document.getElementById('limit-display');

            // Automatick√Ω reset, ak ƒças vypr≈°al
            if (timeRemaining <= 0) {
                resetLimits();
            }

            // Kontrola limitov na z√°klade POU≈ΩIT√ùCH poƒçtov
            const totalLimitReached = currentLimits.messageCount >= MAX_MESSAGES;
            const luaLimitReached = currentLimits.luaRequestCount >= MAX_LUA_REQUESTS;
            
            const isBlocked = totalLimitReached; // Prim√°rne blokujeme len pri limite spr√°v

            // --- ZOBRAZENIE LIMITOV (ZOBRAZUJEME ZOST√ÅVAJ√öCE) ---
            const messagesRemaining = MAX_MESSAGES - currentLimits.messageCount;
            const luaRemaining = MAX_LUA_REQUESTS - currentLimits.luaRequestCount;
            
            const messagesStatus = `${messagesRemaining}/${MAX_MESSAGES} spr√°v`; 
            const luaStatus = `${luaRemaining}/${MAX_LUA_REQUESTS} 3D/Lua`; 

            if (isBlocked) {
                const totalSeconds = Math.ceil(timeRemaining / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                const timeString = `${minutes}m ${seconds}s`;

                limitDisplay.className = 'text-center text-sm font-semibold p-2 rounded-xl text-red-100 bg-red-600/70';
                limitDisplay.innerHTML = `
                    <span class="block">üõë LIMIT VYƒåERPAN√ù!</span>
                    <span>Reset o: ${timeString}</span>
                `;
            } else {
                limitDisplay.className = 'text-center text-sm font-medium p-2 rounded-xl text-white/90 bg-black/20';
                
                let luaWarning = '';
                if (luaLimitReached) {
                    luaWarning = ' | <span class="text-yellow-300 font-bold">Limit Lua k√≥du vyƒçerpan√Ω!</span>';
                }

                limitDisplay.innerHTML = `
                    <span class="block">Limity (Reset: ${formatTime(timeRemaining)}):</span> 
                    <span class="block">${messagesStatus} | ${luaStatus} ${luaWarning}</span>
                `;
            }

            // --- AKTUALIZ√ÅCIA UI PRVKOV ---
            inputElement.disabled = isBlocked || isGenerating;
            buttonElement.disabled = isBlocked || isGenerating;
            inputElement.placeholder = isBlocked ? 
                'Limit vyƒçerpan√Ω. Poƒçkajte na reset.' : 
                (luaLimitReached ? 'M√¥≈æete chatova≈•, ale u≈æ nem√¥≈æete generova≈• 3D/Lua k√≥dy.' : 'Nap√≠≈° svoju ot√°zku...');
        }
        
        /**
         * Form√°tuje milisekundy na min√∫ty a sekundy (M:SS).
         * @param {number} ms Milisekundy
         * @returns {string} Form√°tovan√Ω ƒças
         */
        function formatTime(ms) {
            const totalSeconds = Math.ceil(ms / 1000);
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const paddedSeconds = seconds.toString().padStart(2, '0');
            return `${minutes}:${paddedSeconds}`;
        }

        /**
         * Zobraz√≠ √∫vodn√∫ spr√°vu od AI.
         */
        function displayWelcomeMessage() {
            const welcomeText = `Ahoj! Som **ChatSlovak AI V5 Pro**. Dok√°≈æem s tebou vies≈• be≈æn√∫ komunik√°ciu, odpoveda≈• na ot√°zky vƒèaka Google Search/YouTube, generova≈• pokroƒçil√© Roblox Lua k√≥dy pre NPC a mapy a tie≈æ navrhova≈• **profesion√°lne hudobn√© ≈æ√°nrov√© kƒæ√∫ƒçov√© slov√°** pre n√°stroje ako Suno AI, vr√°tane extr√©mne bassov√Ωch ≈æ√°nrov. Zaƒçnime!`;
            appendMessage('ai', welcomeText, [], false); // Nesmie hovori≈• √∫vodn√∫ spr√°vu
        }

        /**
         * Zobraz√≠ textov√∫ spr√°vu v chatovacom okne.
         * Pridan√Ω parameter `shouldSpeak` pre kontrolu TTS
         */
        function appendMessage(role, text, sources = [], shouldSpeak = true) {
            const messagesContainer = document.getElementById('messages-container');
            const messageElement = document.createElement('div');
            messageElement.className = `flex mb-4 ${role === 'user' ? 'justify-end' : 'justify-start'}`;

            const contentElement = document.createElement('div');
            // Pou≈æ√≠vame markdown pre form√°tovanie, tak≈æe je potrebn√© vlo≈æi≈• text ako HTML
            const markdown = new marked.Renderer();
            markdown.code = (code, language) => {
                const langClass = language ? `language-${language}` : '';
                return `<pre class="bg-gray-800 text-white p-3 rounded-lg overflow-x-auto my-2 text-sm"><code>${code}</code></pre>`;
            };

            contentElement.innerHTML = marked.parse(text, { renderer: markdown, breaks: true });
            contentElement.className = `${role === 'user' ? 'user-message' : 'ai-message'} max-w-3xl`;

            // Pridanie cit√°ci√≠ (zdrojov)
            if (sources.length > 0) {
                const sourcesHtml = sources.map((source, index) => {
                    return `<a href="${source.uri}" target="_blank" class="text-xs text-blue-600 hover:underline block mt-1">${index + 1}. ${source.title}</a>`;
                }).join('');

                const sourcesElement = document.createElement('div');
                sourcesElement.className = 'mt-2 pt-2 border-t border-gray-300 text-gray-700 text-sm';
                sourcesElement.innerHTML = `<strong>Zdroje (Google Search):</strong> ${sourcesHtml}`;
                contentElement.appendChild(sourcesElement);
            }


            messageElement.appendChild(contentElement);
            messagesContainer.appendChild(messageElement);

            // Spustenie TTS
            if (role === 'ai' && shouldSpeak) {
                speakMessage(text);
            }

            // Scroll na spodok
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        /**
         * Zobraz√≠ indik√°tor naƒç√≠tania.
         */
        function showLoading() {
            const messagesContainer = document.getElementById('messages-container');
            const loadingElement = document.createElement('div');
            loadingElement.id = 'loading-indicator';
            loadingElement.className = 'flex justify-start mb-4';
            loadingElement.innerHTML = `
                <div class="ai-message flex items-center space-x-2">
                    <div class="loader"></div>
                    <span>AI generuje odpoveƒè...</span>
                </div>
            `;
            messagesContainer.appendChild(loadingElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        /**
         * Odstr√°ni indik√°tor naƒç√≠tania.
         */
        function hideLoading() {
            const loadingElement = document.getElementById('loading-indicator');
            if (loadingElement) {
                loadingElement.remove();
            }
        }

        /**
         * Funkcia na kontrolu, ƒçi po≈æiadavka vy≈æaduje generovanie Lua k√≥du.
         * @param {string} query Pou≈æ√≠vateƒæsk√Ω dopyt
         * @returns {boolean} True, ak je to po≈æiadavka na Lua k√≥d.
         */
        function isLuaRequest(query) {
            const lowerQuery = query.toLowerCase();
            return LUA_KEYWORDS.some(keyword => lowerQuery.includes(keyword));
        }


        /**
         * Odoslanie spr√°vy do AI.
         */
        async function sendMessage() {
            if (isGenerating) return;

            // 1. Kontrola limitov PRED odoslan√≠m
            initializeLimits(); // Aktualizujeme limity
            
            const totalLimitReached = currentLimits.messageCount >= MAX_MESSAGES;
            if (totalLimitReached) {
                // UI sa u≈æ zablokovalo cez checkAndUpdateUI, len sa vr√°time
                return;
            }

            const input = document.getElementById('user-input');
            const userQuery = input.value.trim();

            if (userQuery === '') return;
            
            // Zastav√≠me pr√≠padn√© hovorenie
            if (synth.speaking) {
                synth.cancel();
            }

            const isLuaReq = isLuaRequest(userQuery);
            const luaLimitReached = currentLimits.luaRequestCount >= MAX_LUA_REQUESTS;

            if (isLuaReq && luaLimitReached) {
                appendMessage('ai', "Prep√°ƒç, limit pre generovanie 3D modelov/Roblox Lua k√≥dov bol pre t√∫to hodinu vyƒçerpan√Ω. M√¥≈æe≈° mi polo≈æi≈• be≈æn√∫ ot√°zku (bez generovania k√≥du).");
                input.value = '';
                return;
            }

            // 2. Zobraz√≠me spr√°vu pou≈æ√≠vateƒæa
            appendMessage('user', userQuery, [], false); // Pou≈æ√≠vateƒæsk√© spr√°vy nehovor√≠me
            input.value = '';

            // Prid√°me dotaz do hist√≥rie chatu
            chatHistory.push({ role: "user", parts: [{ text: userQuery }] });

            // 3. Zobraz√≠me loading indik√°tor
            isGenerating = true;
            checkAndUpdateUI(); // Zablokuje input poƒças generovania
            showLoading();

            try {
                // 4. Priprav√≠me payload
                const payload = {
                    contents: chatHistory,
                    // Prid√°me n√°stroj pre vyhƒæad√°vanie na Google (vr√°tane d√°t z YouTube)
                    tools: [{ "google_search": {} }],
                    // Systemov√© in≈°trukcie pre pokroƒçil√© schopnosti
                    systemInstruction: {
                        parts: [{ text: SYSTEM_PROMPT_SK }]
                    },
                };

                // 5. Implement√°cia Fetch s Exponenci√°lnym Backoffom
                let response;
                const maxRetries = 3;
                let delay = 1000;

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        response = await fetch(API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            break; // √öspe≈°n√© volanie, vyskoƒç√≠me zo sluƒçky
                        } else if (response.status === 429 && i < maxRetries - 1) {
                            // Pr√≠li≈° veƒæa po≈æiadaviek, poƒçk√°me a sk√∫sime znova
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; // Exponenci√°lny backoff
                        } else {
                            // In√© chyby alebo vyƒçerpan√© pokusy
                            throw new Error(`API chyba: ${response.status} ${response.statusText}`);
                        }
                    } catch (error) {
                        if (i === maxRetries - 1) throw error; // Re-throw po poslednom pokuse
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    }
                }

                if (!response || !response.ok) {
                    throw new Error("Nepodarilo sa z√≠ska≈• odpoveƒè od AI po viacer√Ωch pokusoch.");
                }

                const result = await response.json();
                const candidate = result.candidates?.[0];
                let text = "Nastala chyba pri spracovan√≠ odpovede od AI. Sk√∫ste to pros√≠m znova.";
                let sources = [];
                let success = false;

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    text = candidate.content.parts[0].text;
                    success = true;
                    
                    // Z√≠skanie zdrojov
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }
                }

                // 6. Zobraz√≠me odpoveƒè AI a spust√≠me ƒç√≠tanie
                appendMessage('ai', text, sources, true);

                // 7. Aktualizujeme hist√≥riu chatu s odpoveƒèou AI (aj v pr√≠pade chyby, aby nebola preru≈°en√° konverz√°cia)
                chatHistory.push({ role: "model", parts: [{ text: text }] });
                
                // 8. Zv√Ω≈°ime poƒç√≠tadl√° len v pr√≠pade, ≈æe odpoveƒè bola √∫spe≈°n√° (success = true)
                if (success) {
                    currentLimits.messageCount++;
                    if (isLuaReq) {
                        currentLimits.luaRequestCount++;
                    }
                    saveLimits();
                }


            } catch (error) {
                console.error("Chyba volania Gemini API:", error);
                appendMessage('ai', `Prep√°ƒç, nastala kritick√° chyba pri komunik√°cii s AI: ${error.message}`);
            } finally {
                // 9. Odstr√°nime loading indik√°tor a aktualizujeme UI
                isGenerating = false;
                hideLoading();
                checkAndUpdateUI();
            }
        }
    </script>
    <!-- Naƒç√≠tanie Marked.js pre spracovanie Markdownu vo v√Ωstupoch AI, ƒço je d√¥le≈æit√© pre form√°tovanie a Lua k√≥d -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

    <!-- Hlavn√Ω kontajner s glassmorphism efektom -->
    <div class="glass-container w-full max-w-4xl h-[90vh] flex flex-col p-6 rounded-3xl">

        <!-- Hlaviƒçka -->
        <header class="mb-4 pb-2 border-b border-white/50 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-extrabold text-white text-shadow-md">ChatSlovak AI: Pro Model</h1>
                <p class="text-white/80 text-sm">Pr√≠stup k Google Search, generovanie Roblox Lua k√≥du a **hudobn√Ωch promptov** s hodinov√Ωmi limitmi.</p>
            </div>
            
            <!-- TTS Toggle -->
            <div class="flex items-center space-x-2 p-2 rounded-xl bg-white/20">
                <span class="text-white text-sm font-semibold whitespace-nowrap">TTS (Hlas):</span>
                <div id="tts-toggle" class="toggle-switch"></div>
            </div>
        </header>

        <!-- Kontajner pre spr√°vy (Scrollable) -->
        <main id="messages-container" class="flex-grow overflow-y-auto pr-2 mb-4 space-y-4">
            <!-- Spr√°vy bud√∫ pridan√© sem cez JavaScript -->
        </main>

        <!-- Vstupn√° oblas≈• -->
        <div class="flex flex-col space-y-2">
            
            <!-- Zobrazenie Limitov a ƒçasu resetu -->
            <div id="limit-display" class="w-full">
                <!-- Tu sa zobrazia aktu√°lne limity -->
            </div>

            <!-- Vstup a tlaƒçidlo -->
            <div class="flex space-x-3">
                <input type="text" id="user-input" class="glass-input flex-grow p-3 rounded-xl focus:ring-2 focus:ring-blue-400 focus:outline-none placeholder-gray-700 text-gray-900" placeholder="Nap√≠≈° svoju ot√°zku (napr. 'Navrhni ≈æ√°nre pre Suno o extr√©mne bassovej hudbe')">
                <button id="send-button" class="glass-button px-6 py-3 rounded-xl font-semibold text-gray-800 bg-white/50 hover:bg-white/70 flex items-center justify-center" aria-label="Odosla≈• spr√°vu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 19-3-9-9-3Z"/><path d="M22 2 11 13"/></svg>
                </button>
            </div>
        </div>

    </div>

</body>
</html>
















